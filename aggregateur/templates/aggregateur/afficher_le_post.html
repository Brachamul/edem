{% extends "base.html" %}
{% load static %}

{% block head %}{{ block.super }}

<title>{{ post.title }}</title>

<link rel="stylesheet" href="{% get_static_prefix %}css/aggregateur.css" >

{% endblock head %}



{% block content %} {{ block.super }}

<div class="aggregateur self col-sm-12">

	<article class="post clearfix" id="post-{{ post.id }}">
		<div class="postbox">
					{% if post.format == "TEXT" %}
						<a href="{% url 'aggregateur' %}{{ post.slug }}">
					{% elif post.format == "LINK" %}
						<a href="{{ post.link }}" target="_blank">
					{% endif %}
							<h1 class="title">{{ post.title }}</h1>
						</a>
			{% comment %}<span class="source">(<a href="#">loremipsum.com</a>)</span> {% endcomment %}

			{% if post.format == "LINK" and post.illustration %}
			<div class="illustration">
				<a href="{{ post.link }}" target="_blank">
				<img src="{{ post.illustration }}"/>
				</a>
			</div>
			{% endif %}
			<div class="anchor"></div>

			<div class="meta">
				<span class="author">Par <a href="{% url 'membres' %}{{ post.author.id }}">{{ post.author.profil.nom_courant }}</a></span>
				<span class="date">, il y a <time datetime="{{ post.date }}">{{ post.date|timesince }}</time></span>
				{% comment %}<span class="channel"> dans <a href="#">/c/posts</a></span>{% endcomment %}
			</div>

			<div class="healthbox">
				<span class="vote pos {% if post.color == "POS" %}active{% endif %}" data-postid="{{ post.id }}">▲<sup>+1</sup></span>
				<span class="health">{{ post.health }}</span>
				<span class="vote neg {% if post.color == "NEG" %}active{% endif %}" data-postid="{{ post.id }}">▼<sup>-1</sup></span>
			</div>

			{% if post.format == "TEXT" %}
			<div class="content">
				{% load markdown_deux_tags %}
				{{ post.content|markdown }}
			</div>
			{% endif %}
			
			<div class="actions">
				<span class="nombre-de-commentaires">
					<a href="{% url 'aggregateur' %}{{ post.slug }}">
					{% if post.number_of_comments = 0 %}
						pas de commentaires
					{% else %}
						{{ post.number_of_comments }} commentaire{{ post.number_of_comments|pluralize }}
					{% endif %}
					</a>
				</span>
{% comment %}	<span class="share">partager</span> {% endcomment %}
{% comment %}	<span class="favorite">ajouter aux favoris</span> {% endcomment %}
{% comment %}	<span class="hide">cacher</span> {% endcomment %}
{% comment %}	<span class="report">signaler</span> {% endcomment %}
			</div>
		</div>
	</article>

	<div class="comments">
	{% comment %} This code also exists in the "commentaire" page {% endcomment %}

		<input id="checkbox-replyto-post-{{ post.pk }}" type="checkbox"/>
		<label class="btn btn-primary btn-block root-commentor" for="checkbox-replyto-post-{{ post.pk }}" role="button">Commenter</label>
		<div class="comment-form panel-body root-commentor">
			<form method="POST" action="" enctype="multipart/form-data">
				<div class="form-group">
					{% csrf_token %}
					<div class="form-group">
						{{ comment_form.content.field.errors }}
						{{ comment_form.content }}
					</div>
					<input type="hidden" name="action" value="nouveau_commentaire">
					<input type="hidden" name="parent_post" value="{{ post.pk }}">
					<button type="submit" class="btn btn-primary">Poster</button>
					<label class="btn btn-default" for="checkbox-replyto-post-{{ post.pk }}">Cacher</label>
				</div>
			</form>
		</div>
		
		{% for comment in post.comment_set.all %}
			{% include "aggregateur/commentaire.html" %}
		{% endfor %}

	</div>

</div>

{% endblock content %}



{% block scripts %} {{ block.super }}

<script src="{% get_static_prefix %}js/aggregateur.js"></script>

{% endblock scripts %}