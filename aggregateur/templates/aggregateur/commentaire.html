<input id="checkbox-close-comment-{{ comment.pk }}" type="checkbox" />

<div class="comment" id="comment-{{ comment.pk }}">

	<div class="meta">
		<label for="checkbox-close-comment-{{ comment.pk }}">[<span class="minus">–</span><span class="plus">+</span>]</label>
		<span class="author">Par <a href="{% url 'membres' %}{{ comment.author.id }}">{{ comment.author.profil.nom_courant }}</a></span>
		<span class="date">, il y a <time datetime="{{ comment.date }}">{{ post.date|timesince }}</time></span>
	</div>

	<div class="healthbox">
		<span class="vote pos {% if comment.color == "POS" %}active{% endif %}" data-commentid="{{ comment.id }}">▲</span>
		<span class="health">{{ comment.health }}</span>
		<span class="vote neg {% if comment.color == "NEG" %}active{% endif %}" data-commentid="{{ comment.id }}">▼</span>
	</div>
	
	<input id="checkbox-modify-comment-{{ comment.pk }}" type="checkbox"/>

	<div class="content">
		{% load markdown_deux_tags %}
		{{ comment.content|markdown }}
		{% if comment.deleted %}<span class="deleted">- supprimé</span>{% endif %}
	</div>
	
	{% if comment.author == user %}
	<form class="modifier" method="POST" action="" enctype="multipart/form-data">
		<div class="form-group">
			{% csrf_token %}
			<textarea id="comment-input" name="content" rows="5" class="form-control" maxlength="10000">{{ comment.content }}</textarea>
			<input type="hidden" name="action" value="modifier_le_commentaire">
			<input type="hidden" name="comment-pk" value="{{ comment.pk }}">
		</div>
		<div class="form-group">
			<button type="submit" class="btn btn-default btn-sm">
				<span class="glyphicon glyphicon-ok"></span>
				Enregistrer
			</button>
			</input>
			<label for="checkbox-modify-comment-{{ comment.pk }}" class="btn btn-default btn-sm cancel-edit">
				<span class="glyphicon glyphicon-remove"></span>
				Annuler
			</label>
		</div>
	</form>
	{% endif %}

	<div class="actions">
		<a href="{% url 'commentaire' post.slug comment.pk %}">
			<span class="permalink">lien</span>
		</a>
		{% if user == comment.author %}
			{% if not comment.deleted %}
			<form class="supprimer form-inline" method="POST" action="" enctype="multipart/form-data">
				<label for="checkbox-delete-comment-{{ comment.pk }}"><span class="report">supprimer</span></label>
				<input id="checkbox-delete-comment-{{ comment.pk }}" type="checkbox"/>
				{% csrf_token %}
				<input type="hidden" name="content" value="">
				<input type="hidden" name="action" value="modifier_le_commentaire">
				<input type="hidden" name="comment-pk" value="{{ comment.pk }}">
				<button type="submit" class="btn btn-warning btn-xs">confirmer la suppresion ?</button>
			</form>
			{% endif %}
		<label for="checkbox-modify-comment-{{ comment.pk }}"><span class="modify">modifier</span></label>
		{% endif %}
		<label for="checkbox-replyto-comment-{{ comment.pk }}">
		<span class="reply">répondre</span></label>
{% comment %}	<span class="report">signaler</span> {% endcomment %}
	</div>

{% comment %} This code also exists in the "afficher_le_post" page {% endcomment %}
<input id="checkbox-replyto-comment-{{ comment.pk }}" type="checkbox"/>
<div class="comment-form panel-body">
	<form method="POST" action="" enctype="multipart/form-data">
		<div class="form-group">
			{% csrf_token %}
			<div class="form-group">
				{{ comment_form.content.field.errors }}
				{{ comment_form.content }}
			</div>
			<input type="hidden" name="action" value="nouveau_commentaire">
			<input type="hidden" name="parent_comment" value="{{ comment.pk }}">
			<button type="submit" class="btn btn-primary">Poster</button>
			<label class="btn btn-default" for="checkbox-replyto-comment-{{ comment.pk }}">Cacher</label>
		</div>
	 </form>
</div>

{% for comment in comment.comment_set.all %}
		{% include "aggregateur/commentaire.html" %}
{% endfor %}

</div>